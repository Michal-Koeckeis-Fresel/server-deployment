#!/bin/bash
#
# Copyright (c) 2025 Michal Koeckeis-Fresel
# 
# This software is dual-licensed under your choice of:
# - MIT License (see LICENSE-MIT)
# - GNU Affero General Public License v3.0 (see LICENSE-AGPL)
# 
# SPDX-License-Identifier: MIT OR AGPL-3.0-or-later
#

# BunkerWeb Configuration File
# Edit the values below before running the setup script

# Debug Configuration
DEBUG="no"                       # Enable debug mode: yes or no (default: no)

# Default admin username
ADMIN_USERNAME="admin"

# Release Channel Configuration
RELEASE_CHANNEL="latest"         # Options: latest, RC, nightly, X.Y.Z (e.g., 1.6.1)

# SSL Certificate Configuration
AUTO_CERT_TYPE="LE"              # Certificate type: LE or ZeroSSL
AUTO_CERT_CONTACT="me@example.com"  # Contact email for certificates (CHANGE THIS!)

# Domain Configuration
FQDN=""                          # Fully Qualified Domain Name (auto-detected if not set)
SERVER_NAME=""                   # Primary domain name (same as FQDN in single domain setups)

# Network Configuration
PRIVATE_NETWORKS_ALREADY_IN_USE=""  # Space-separated list of CIDR networks to avoid
PREFERRED_DOCKER_SUBNET=""       # Preferred subnet for Docker (auto-selected if empty)

# BunkerWeb Instance Configuration
BUNKERWEB_INSTANCES="127.0.0.1"

# Multisite Configuration
MULTISITE="yes"                  # Enable multisite mode (supports multiple domains)

# Security Configuration
SECURITY_MODE="block"            # Security level: detect or block
SERVER_TYPE="http"               # Server type: http or stream

# Allowlist Configuration (Global Access Control)
USE_ALLOWLIST="no"               # Enable global IP allowlist
ALLOWLIST_IP=""                  # IP addresses/networks to allow access
ALLOWLIST_COUNTRY=""             # Country codes to allow (e.g., "US CA GB")
BLACKLIST_COUNTRY=""             # Country codes to block (e.g., "CN RU KP")
ALLOWLIST_RDNS=""                # Reverse DNS suffixes to allow
ALLOWLIST_MODE="block"           # What to do with non-allowlisted IPs: block or deny
ALLOWLIST_STATUS_CODE="403"      # HTTP status code for blocked requests

# Greylist Configuration (Admin Interface Protection)
USE_GREYLIST="yes"               # Enable greylist for admin interface
GREYLIST_IP="10.0.0.0/8 172.16.0.0/12 192.168.0.0/16"  # IP addresses/networks to greylist
GREYLIST_RDNS=""                 # Reverse DNS suffixes to greylist

# SSH Trusted Configuration
ADD_SSH_TO_TRUSTED="yes"         # Automatically add SSH connections to trusted lists
SSH_TRUSTED=""                   # List of additional trusted SSH IP addresses/networks

# FQDN Detection Configuration
FQDN_REQUIRE_SSL="yes"
FQDN_CHECK_DNS="yes"
FQDN_ALLOW_LOCALHOST="no"
FQDN_LOG_LEVEL="INFO"
FQDN_STRICT_MODE="yes"

# Redis Configuration
REDIS_ENABLED="yes"              # Enable Redis support: yes or no

# Syslog Configuration
SYSLOG_ENABLED="yes"             # Enable external syslog: yes or no

# Let's Encrypt Advanced Options
LETS_ENCRYPT_CHALLENGE="http"    # Challenge type: http or dns
LETS_ENCRYPT_STAGING="yes"       # Use staging environment: yes or no
LETS_ENCRYPT_WILDCARD="no"       # Enable wildcard certificates: yes or no